function getIcon(){var n="";return n=colors[Math.floor(Math.random()*4)],Math.floor(Math.random()*25)<3&&(n+="2"),n}function theMansWord(){var t=Math.floor(Math.random()*11)+1,n="";switch(t){case 1:n=mode=="easy"?"I can take 6 most in hand":"I can take 5 most in hand";break;case 2:n="High score is "+highScore+", carry on";break;case 3:n="Want more? Contact me";break;case 4:n="I look best in Webkit browsers";break;case 5:n="Waste separation is important";break;case 6:n="I don't need Flash plugin";break;case 7:n="Do you find best strategy?";break;case 8:n="Strategy is important";break;case 9:n="Avoid -2 scores";break;case 10:n="Best players can score 90+";break;case 11:n="You can press F5 to restart"}return n}function shuffle(n){for(var u,t,f,i=n.length,r=0;r<3*i;r++)u=Math.floor(Math.random()*i),t=Math.floor(Math.random()*i),f=n[u],n[u]=n[t],n[t]=f}function sleep(n){for(var t=!0,i=+new Date;t;)nowMSeconds=+new Date,nowMSeconds-i>n&&(t=!1)}function waitAnimationDone(n,t){var i=setInterval(function(){tweenObjsCount==0&&(clearInterval(i),window[n].apply(this,t))},300)}function addTotalScore(){var n=$("#scores img:last").attr("src").split("/")[1].split(".")[0],t=n.slice(6,n.length);return totalScore=totalScore+parseInt(t),window.totalScore}function subTotalScore(n){totalScore=totalScore-n,$("#totalScore").html("Score: "+totalScore)}function checkFactory(n,t){return factoryValue[n]+t>3?(factoryValue[n]=0,!0):(factoryValue[n]=t+factoryValue[n],!1)}function setup(){var c=".gif",s="icon",o="<img/>",n=" ",i=easyScores,t,u,e;i=mode=="easy"?easyScores:normalScores,$("#instruction").fadeIn("normal");var y=i.length,v="",l="",f="",a="",h=-1,r="";for(t=0;t<4;t++){for(v=shortColors[t],l=colors[t],f="#"+l+n+"div.scorePile",a="#"+l+n+"div.dump.iconPile",shuffle(i),h=-1,u=0;u<y;u++)h=i[u],position=$(f+n+"img").length+1,$(o,{"class":s+n+"round",src:"images/score"+v+h+c}).css("left",position*10+"px").appendTo(f);$(f+n+"img:last").addClass("lastScore").click(function(){tweenObjsCount==0&&($(this).attr("src","images/scorec1.gif"),takeScore($(this).parent().parent().attr("id")))}),r=getIcon(),$(o,{"class":s+n+"slot1",src:"images/"+r+c}).appendTo(a)}for(e=0;e<3;e++)r=getIcon(),$(o,{"class":s+n+"hand",src:"images/"+r+c}).appendTo("#handIcons");$(".hand").click(function(){preparePlay(this)})}function takeScore(n){var f="px",i="img:last",u="#scores",t=" ",r="#"+n+t+"div.scorePile",o=$(r).offset(),e=$(u).offset();tweenObjsCount++,TweenLite.to($(r+t+i),iconMoveSpeed,{css:{top:e.top-o.top-50+f,left:e.left-o.left+50+f},onComplete:function(){tweenObjsCount--}}),tweenObjsCount++,TweenLite.to($(r+t+i),iconFadeSpeed,{delay:iconMoveSpeed,css:{opacity:"0"},onComplete:function(){var o="#scores img",s=-Math.floor($(o).length/10)*50,h=$(o).length%10*15,e;$(r+t+i).removeClass().addClass("icon"+t+"round").appendTo(u),$(u+t+i).removeAttr("style"),$(u+t+i).css("left",h+f).css("top",s+f).addClass("front"),e=addTotalScore(),$("#totalScore").html("Score: "+e),$(r+t+i).addClass("lastScore").click(function(){tweenObjsCount==0&&($(this).attr("src","images/scorec1.gif"),takeScore($(this).parent().parent().attr("id")))}),waitAnimationDone("collect",[n]),tweenObjsCount--}})}function collect(n){var u="#handIcons",t="#"+n+" div.dump.iconPile",o="#"+n+" div.factory.iconPile",f=$(t).offset(),e=$("#man").offset(),i=$(t+" img"),s=$(t+" img:last"),r;tweenObjsCount++,TweenLite.to(i,iconMoveSpeed,{css:{top:e.top-f.top+40+"px",left:e.left-f.left+30+"px"},onComplete:function(){tweenObjsCount--}}),r=i.not(":last"),tweenObjsCount++,TweenLite.to(r,iconFadeSpeed,{delay:iconMoveSpeed,css:{opacity:"0"},onComplete:function(){$(this.target).click(function(){preparePlay(this)}),$(this.target).removeClass().addClass("icon").addClass("hand").appendTo(u),$(this.target).removeAttr("style"),tweenObjsCount--}}),tweenObjsCount++,TweenLite.to(s,iconFadeSpeed,{delay:iconMoveSpeed,css:{opacity:"0"},onComplete:function(){$(this.target).click(function(){preparePlay(this)}),$(this.target).removeClass().addClass("icon").addClass("hand").appendTo(u),$(this.target).removeAttr("style"),waitAnimationDone("dump",[n,$(o+" img").length+1]),tweenObjsCount--}})}function dump(n,t){for(var f="#"+n+" div.dump.iconPile",i=0,r=0,u="",i=0;i<t;i++){if(u=getIcon(),r=$(f+" img").length+1,r>4)return;$("<img/>",{"class":"icon slot"+r,src:"images/"+u+".gif"}).appendTo(f).hide().fadeIn("slow")}waitAnimationDone("checkGameover",[])}function checkGameover(){var n="#handIcons img",t=!1;if($(".scorePile").each(function(){$(this).children().length<1&&(t=!0)}),t){gameOver("win");return}mode=="easy"?$(n).length>6&&gameOver("lose"):$(n).length>5&&gameOver("lose")}function gameOver(n){var r="highScore",u="#state",t,i;n=="lose"?$(u).html("Game Over"):($(u).html("You Win"),totalScore=totalScore+4),t=0,window.localStorage&&(i=window.localStorage,i.getItem(r)||i.setItem(r,0),t=parseInt(i.getItem(r)),totalScore>t&&i.setItem(r,totalScore)),totalScore>t&&(t=totalScore,$(u).html("New Record")),$("#endScore").html("Score: "+totalScore),$("#highScore").html("High Score: "+t),$("#gameOver").fadeIn("normal")}function preparePlay(n){var r="normal",t="#manSay",f="prepare",u="unknown",i=$(n).attr("src").split("/")[1].split(".")[0];i[i.length-1]=="2"&&(i=i.slice(0,i.length-1)),choosenColor==u||choosenColor==i?($(n).toggleClass(f),choosenColor==u&&$(t).fadeOut(r,function(){$(t).html("OK"),$(t).addClass("ok"),$(t).fadeIn(r)}),choosenColor=i,$(".hand.prepare").length==0&&(choosenColor=u,$(t).fadeOut(r,function(){$(t).html(theMansWord()),$(t).removeClass("ok"),$(t).fadeIn(r)}))):($(".prepare").removeClass(f),$(n).toggleClass(f),choosenColor=i)}function playIcon(){var t=" ",r=$(".hand.prepare"),f="unknown",n="unknown";r.each(function(){if(f!=!0){n=$(this).attr("src").split("/")[1].split(".")[0];var i=0;n[n.length-1]=="2"?(i=2,n=n.slice(0,n.length-1)):i=1,f=checkFactory(n,i)}}),r.removeClass("prepare");var i="#"+n+t+"div.factory.iconPile",e=$(i).offset(),u=0;r.each(function(){u=$(this).offset(),tweenObjsCount++,TweenLite.to($(this),iconMoveSpeed,{css:{top:e.top-u.top+100+"px",left:e.left-u.left+30+"px"},onComplete:function(){tweenObjsCount--}})}),r.not(":last").each(function(){tweenObjsCount++,TweenLite.to($(this),iconFadeSpeed,{delay:iconMoveSpeed,css:{opacity:"0"},onComplete:function(){var n=$(i+t+"img").length+1;$(this.target).removeClass().addClass("icon"+t+"slot"+n).appendTo(i),$(this.target).removeAttr("style"),tweenObjsCount--}})}),tweenObjsCount++,TweenLite.to(r.last(),iconFadeSpeed,{delay:iconMoveSpeed,css:{opacity:"0"},onComplete:function(){var u=$(i+t+"img").length+1;$(this.target).removeClass().addClass("icon"+t+"slot"+u).appendTo(i),$(this.target).removeAttr("style"),f?(r.add(i+t+"img").fadeOut("slow",function(){$(this).remove()}),waitAnimationDone("takeScore",[n])):waitAnimationDone("collect",[n]),tweenObjsCount--}})}function testTimerClicked(){var n="animating : "+tweenObjsCount;$("#testBlock5").html(n),setTimeout("testTimerClicked()",500)}var mode="normal",easyScores=[-2,-2,2,3,3,4,4],normalScores=[-2,-2,3,3,4,4,5,5],colors=["red","blue","yellow","green"],shortColors=["r","b","y","g"],totalScore=0,highScore=0,factoryValue={red:0,blue:0,yellow:0,green:0},choosenColor="unknown",tweenObjsCount=0,iconMoveSpeed=.5,iconFadeSpeed=.5;$(function(){var n="#manSay",e="#helpPage",u="normal",t="slow",f="#welcome",r="highScore";if(window.localStorage){var i=window.localStorage;i.getItem(r)||i.setItem(r,0),highScore=parseInt(i.getItem(r)),$("#welcomeHighScore").html("High Score: "+highScore)}$("#instruction").hide(),$("#easyButton").click(function(){mode="easy",setup(),$(f).fadeOut(t)}),$("#normalButton").click(function(){mode=u,setup(),$(f).fadeOut(t)}),$("#howButton").click(function(){$(e).fadeIn(t)}),$(e).click(function(){$(this).fadeOut(t)}),$("#restart").click(function(){window.location.reload()}),setTimeout("testTimerClicked()",100),$(n).click(function(){tweenObjsCount==0&&$(".hand.prepare").length!=0&&$(n).hasClass("ok")!=!1&&(playIcon(),choosenColor="unknown",$(n).fadeOut(u,function(){$(n).html(theMansWord()),$(n).removeClass("ok"),$(n).fadeIn(u)}))})});